<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shopping</title>
    <link rel="stylesheet" href="https://unpkg.com/react-calendar/dist/Calendar.css">
    <style>
        html {
            background-color: #FFFEF0;
        }
        /*임시*/
        #Calendar {
            border: 1px solid #ccc;
            height: auto; /* 자동 높이 설정 */
            width: 300px; /* 적절한 너비 설정 */
            border-radius: 5px;
            background-color: #F2F2EB;
            padding: 10px; /* 내부 여백 추가 */
            position: relative; /* 자식 요소의 절대 위치를 위한 상대 위치 */
        }
        /*임시*/
        #List {
            border: 1px solid #ccc;
            height: 600px;
            width: 600px;
            border-radius: 5px; /* 네모박스에 모서리 둥글게 */
            background-color: #F2F2EB;
        }
        /* 이미지 크기를 150px로 설정 */
        .product-image {
            width: auto; /* 너비는 자동으로 비율에 맞게 조정 */
            height: 150px; /* 높이를 150px로 설정 */
        }
        /* 결과 리스트 스타일 */
        #resultContainer {
            list-style-type: none; /* 기본 리스트 스타일 제거 */
            padding: 0; /* 패딩 제거 */
            border: 1px solid #ccc; /* 전체 리스트에 테두리 추가 */
            border-radius: 5px; /* 네모박스에 모서리 둥글게 */
            overflow: hidden; /* 내부 내용이 넘치지 않게 설정 */
            background-color: #F2F2EB;
        }
        /* 리스트 항목 스타일 */
        .product-item {
            padding: 10px; /* 내부 여백 설정 */
            border-bottom: 1px solid #ccc; /* 항목 사이에 선 추가 */
            display: flex; /* Flexbox 사용 */
            align-items: center; /* 세로 중앙 정렬 */
        }
        /* 마지막 항목에서 하단 선 제거 */
        .product-item:last-child {
            border-bottom: none; /* 마지막 항목의 하단 선 제거 */
        }
        /* 제목과 가격을 포함하는 컨테이너 스타일 */
        .product-info {
            margin-left: 10px; /* 이미지와의 간격 설정 */
        }
        /* 링크 스타일 */
        .product-info a {
            text-decoration: none; /* 밑줄 제거 */
            color: black; /* 텍스트 색상 (검정색) */
        }
        /* 가격 스타일 */
        .product-price {
            font-size: 1.5em; /* 글자 크기를 H3 정도로 설정 (약 1.5em) */
            margin: 0; /* 기본 마진 제거 */
        }
        /* 페이지네이션 스타일 */
        .pagination {
            margin-top: 20px; /* 페이지네이션과 상품 리스트 간격 */
            display: flex;
            justify-content: center; /* 중앙 정렬 */
        }
        .page-item {
            margin: 0 5px; /* 페이지 아이템 간격 */
            cursor: pointer; /* 커서 포인터 */
            padding: 5px 10px; /* 여백 설정 */
            border: 1px solid #ccc; /* 테두리 */
            border-radius: 5px; /* 모서리 둥글게 */
        }
        button {
            background: none; /* 버튼 배경 제거 */
            border: none; /* 버튼 테두리 제거 */
            cursor: pointer; /* 커서 포인터 */
            padding: 5px 10px; /* 여백 설정 */
        }
        #sortButtons {
            display: flex;
            justify-content: flex-end; /* 버튼들을 오른쪽에 배치 */
        }
    </style>
</head>
<body>
<div id="root"></div>
<script type="module">
    import React from 'https://unpkg.com/react@17/umd/react.development.js';
    import ReactDOM from 'https://unpkg.com/react-dom@17/umd/react-dom.development.js';
    import Calendar from 'https://cdn.jsdelivr.net/npm/react-calendar/dist/umd/react-calendar.development.js';
    const { useState } = React;

    function App() {
        const [date, setDate] = useState(new Date());

        const handleDateChange = (newDate) => {
            setDate(newDate);
            console.log(newDate);
        };

        return (
            <>
                <div>
                    <Calendar onChange={handleDateChange} value={date} />
                </div>
            </>
        );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
</script>
<div id="List"></div>
<div id="recommend">
    <!-- 버튼 추가 -->
    <div id="sortButtons">
        <button id="sortByAccuracy">정확도순</button>
        <button id="sortByPrice">최저가순</button>
    </div>

    <!-- 검색 결과를 표시할 곳 -->
    <ul id="resultContainer"></ul> <!-- ul로 변경 -->

    <!-- 페이지네이션 표시 -->
    <div class="pagination" id="paginationContainer">
        <button id="prevPage" class="page-item">이전</button>
        <span id="pageInfo"></span>
        <button id="nextPage" class="page-item">다음</button>
    </div>
    <script>
        let products = []; // 전역 변수로 상품 배열을 선언
        let currentPage = 1; // 현재 페이지
        const itemsPerPage = 5; // 페이지당 아이템 수

        // 페이지 로드 시 자동으로 검색
        document.addEventListener("DOMContentLoaded", function() {
            const query = "%ED%8E%AB%20%EC%9A%A9%ED%92%88";  // 예: "펫 용품"
            searchProducts(query); // 초기 검색 실행
        });

        // 제품 검색 함수
        function searchProducts(query, sort = '') {
            // API 요청 보내기
            fetch('/searchProducts?query=' + query + '&display=' + 100 + sort)
                .then(response => response.json())
                .then(data => {
                    products = data.items; // 전체 상품 데이터를 저장
                    displayResults(products); // 결과 표시
                    setupPagination(products.length); // 페이지네이션 설정
                })
                .catch(error => console.error('Error fetching data:', error));
        }

        // 결과를 HTML에 표시하는 함수
        function displayResults(data) {
            const resultContainer = document.getElementById("resultContainer");
            resultContainer.innerHTML = '';  // 기존 내용 초기화

            // 페이지에 따라 데이터 필터링
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const paginatedData = data.slice(startIndex, endIndex);

            // 각 상품을 화면에 표시
            paginatedData.forEach(item => {
                const productItem = document.createElement('li'); // li 요소 생성
                productItem.classList.add('product-item'); // 클래스 추가
                productItem.innerHTML =
                    `<img src="${item.image}" alt="${item.title}" class="product-image">
                        <div class="product-info">
                            <a href="${item.link}">${item.title}</a>
                            <br>
                            <a href="${item.link}" class="product-price">Price: ${item.price} 원</a>
                        </div>`;
                resultContainer.appendChild(productItem); // 리스트에 추가
            });

        }

        // 페이지네이션 설정 함수
        function setupPagination(totalItems) {
            const pageCount = Math.ceil(totalItems / itemsPerPage);
            const pageInfo = document.getElementById("pageInfo");
            pageInfo.innerHTML = `${currentPage} / ${pageCount}`; // 현재 페이지 정보 표시

            document.getElementById("prevPage").style.display = currentPage === 1 ? 'none' : 'inline';
            document.getElementById("nextPage").style.display = currentPage === pageCount ? 'none' : 'inline';
        }

        // 페이지 변경 함수
        function changePage(direction) {
            const pageCount = Math.ceil(products.length / itemsPerPage);
            if (direction === 'next' && currentPage < pageCount) {
                currentPage++;
            } else if (direction === 'prev' && currentPage > 1) {
                currentPage--;
            }
            displayResults(products); // 결과 재표시
            setupPagination(products.length); // 페이지네이션 재설정
        }

        // 이전 페이지 버튼 클릭 이벤트
        document.getElementById("prevPage").addEventListener("click", () => changePage('prev'));

        // 다음 페이지 버튼 클릭 이벤트
        document.getElementById("nextPage").addEventListener("click", () => changePage('next'));

        // 정확도순 정렬 버튼 클릭 이벤트
        document.getElementById("sortByAccuracy").addEventListener("click", () => {
            products.sort((a, b) => a.accuracy - b.accuracy); // 정확도 순으로 정렬
            displayResults(products); // 결과 재표시
        });

        // 최저가순 정렬 버튼 클릭 이벤트
        document.getElementById("sortByPrice").addEventListener("click", () => {
            products.sort((a, b) => a.price - b.price); // 가격 순으로 정렬
            displayResults(products); // 결과 재표시
        });
    </script>
</div>
</body>
</html>